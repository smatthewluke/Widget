System.register(["jimu-core/react","jimu-core","jimu-arcgis","esri/views/MapView","esri/geometry/Point","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/geometry/SpatialReference","esri/geometry/support/webMercatorUtils","esri/core/reactiveUtils","esri/geometry/Polyline","esri/geometry/Polygon","esri/Color","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/Font","esri/symbols/TextSymbol"],(function(e,t){var r={},o={},a={},n={},i={},l={},s={},u={},c={},f={},d={},p={},m={},g={},y={},w={},b={},h={},v={};return{setters:[function(e){r.useEffect=e.useEffect,r.useRef=e.useRef,r.useState=e.useState},function(e){o.React=e.React},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default},function(e){i.default=e.default},function(e){l.default=e.default},function(e){s.default=e.default},function(e){u.default=e.default},function(e){c.default=e.default},function(e){f.canProject=e.canProject,f.project=e.project},function(e){d.watch=e.watch},function(e){p.default=e.default},function(e){m.default=e.default},function(e){g.default=e.default},function(e){y.default=e.default},function(e){w.default=e.default},function(e){b.default=e.default},function(e){h.default=e.default},function(e){v.default=e.default}],execute:function(){e((()=>{var e={26:e=>{"use strict";e.exports=b},89:e=>{"use strict";e.exports=l},114:e=>{"use strict";e.exports=v},196:e=>{"use strict";e.exports=p},205:e=>{"use strict";e.exports=c},231:e=>{"use strict";e.exports=n},243:e=>{"use strict";e.exports=d},244:e=>{"use strict";e.exports=o},272:e=>{"use strict";e.exports=f},417:e=>{"use strict";e.exports=y},420:e=>{"use strict";e.exports=u},422:e=>{"use strict";e.exports=i},442:e=>{"use strict";e.exports=g},526:e=>{"use strict";e.exports=m},600:e=>{"use strict";e.exports=h},620:e=>{"use strict";e.exports=s},686:e=>{"use strict";e.exports=a},897:e=>{"use strict";e.exports=w},972:e=>{"use strict";e.exports=r}},t={};function P(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,P),a.exports}P.d=(e,t)=>{for(var r in t)P.o(t,r)&&!P.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},P.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),P.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},P.p="";var x={};return P.p=window.jimuConfig.baseUrl,(()=>{"use strict";P.r(x),P.d(x,{__set_webpack_public_path__:()=>E,default:()=>S});var e=P(972),t=P(244),r=P(686),o=P(231),a=P(422),n=P(89),i=P(620),l=P(420),s=P(205),u=P(272),c=P(243),f=P(196),d=P(526),p=P(442),m=P(417),g=P(897),y=P(26),w=P(600),b=P(114);const h=e=>{var t=e.mapping3d.sdk.viewer.MapObject,r=e.mapping3d.sdk.viewer.AList,o=e.mapping3d.sdk.viewer.Coordinate,i=e.mapping3d.sdk.viewer.CoordinatePart,l=e.mapping3d.sdk.viewer.CoordinatePath,c=new p.default([0,0,255,1]),h=new p.default([0,0,255,.1]),v=new p.default([255,255,255,1]),P=0;return{getMapObjectForGraphic:function(e){let r=e.geometry,n=4326,i=new s.default({wkid:n});if(!(0,u.canProject)(r,i))return console.error("Cannot create mapobject for graphic, because we cannot project it to epsg:"+n),null;r=(0,u.project)(r,i);var l=new t;if(l.objectId=""+P++,r instanceof a.default)l.spatialPoint=new o(""+n,r.x,r.y,0,!1);else if(r instanceof f.default)l.spatialLine=this.getCoordinatePathForGeometry(""+n,r);else{if(!(r instanceof d.default))return console.error("Invalid geometry type: ",typeof r,"."),null;l.spatialArea=this.getCoordinatePathForGeometry(""+n,r)}return l},getCoordinatePathForGeometry:function(e,t){let n=new r(i.TYPE);(t.paths||t.rings).forEach((e=>{let t=new r(o.TYPE);if(e.forEach((e=>{e instanceof a.default?t.add(new o(null,e.x,e.y,0,!1)):e instanceof Array&&e.length>1?t.add(new o(null,e[0],e[1],0,!1)):console.error("Cannot add point ",e)})),t.size()>0){let e=new i;e.points=t,n.add(e)}}));let s=new l;return s.crs=e,s.parts=n,s},getGraphicForMapObject:function(e){let t=null;return e.spatialPoint&&(t=new n.default,t.geometry=new a.default({x:e.spatialPoint.x,y:e.spatialPoint.y}),t.attributes={mapObject:e},t.symbol=this.getSymbolForPoint(e)),e.spatialLine&&(t=new n.default,t.geometry=this.getGeometryForLine(e),t.attributes={mapObject:e},t.symbol=this.getSymbolForLine(e)),e.spatialArea&&(t=new n.default,t.geometry=this.getGeometryForArea(e),t.attributes={mapObject:e},t.symbol=this.getSymbolForArea(e)),t},getGeometryForLine:function(e){for(var t=[],r=0;r<e.spatialLine.parts.size();r++){for(var o=[],a=e.spatialLine.parts.get(r),n=0;n<a.points.size();n++){var i=a.points.get(n);o.push([i.x,i.y,i.z])}t.push(o)}return new f.default(1==t.length?t[0]:t)},getGeometryForArea:function(e){for(var t=[],r=0;r<e.spatialArea.parts.size();r++){for(var o=[],a=e.spatialArea.parts.get(r),n=0;n<a.points.size();n++){var i=a.points.get(n);o.push([i.x,i.y,i.z])}t.push(o)}return new d.default(1==t.length?t[0]:t)},getSymbolForLabel:function(e){var t=v,r="14",o="Arial";if(e.labelFontSize&&(r=e.labelFontSize),e.labelFontFamily&&(o=e.labelFontFamily),e.labelColor){var a=e.labelColor.alpha/255,n=e.labelColor.red,i=e.labelColor.green,l=e.labelColor.blue;t=new p.default([n,i,l,a])}var s=new w.default({size:r+"px",style:"normal",weight:"bold",family:o}),u=new b.default({text:e.label,font:s,color:t});return u.horizontalAlignment="center",u.verticalAlignment="middle",e.labelPosition&&(u.xoffset=e.labelPosition.x,u.yoffset=-e.labelPosition.y),u},getSymbolForPoint:function(e){var t=h,r=-1!=e.symbolSize?e.symbolSize:void 0;if(e.fillColor){var o=e.fillColor.alpha/255,a=e.fillColor.red,n=e.fillColor.green,i=e.fillColor.blue;t=new p.default([a,n,i,o])}if(e.symbolPath){var l=this.getSymbolPath(e),s=l[0],u=l[1];return void 0===r&&(r=2*s),new m.default({style:"path",color:t,outline:this.getSymbolForLine(e),size:r,path:u})}return new m.default({style:"circle",color:t,outline:this.getSymbolForLine(e),size:r})},getSymbolForLine:function(e){var t=c,r=e.lineWidth||1;if(e.color){var o=e.color.alpha/255,a=e.color.red,n=e.color.green,i=e.color.blue;t=new p.default([a,n,i,o])}return new g.default({style:"solid",color:t,width:r})},getSymbolForArea:function(e){var t=h;if(e.fillColor){var r=e.fillColor.alpha/255,o=e.fillColor.red,a=e.fillColor.green,n=e.fillColor.blue;t=new p.default([o,a,n,r])}return new y.default({style:"solid",outline:this.getSymbolForLine(e),color:t})},getSymbolPath:function(e){if(!e.symbolPath)return null;for(var t=0,r=0,o="",a=0;a<e.symbolPath.parts.size();a++)for(var n=e.symbolPath.parts.get(a),i=0;i<n.points.size();i++){var l=n.points.get(i);t=Math.max(Math.abs(l.x),t),r=Math.max(Math.abs(l.y),r),o+=(0==i?"M":"L")+l.x+","+l.y}var s=Math.max(t,r),u=[-s,s,s,s,s,-s,-s,-s];return[s,"M"+u[0]+","+u[1]+"M"+u[2]+","+u[3]+"M"+u[4]+","+u[5]+"M"+u[6]+","+u[7]+o]}}},v=({widgetProps:f,orbitgt:d})=>{var p;const m=(0,e.useRef)(),g=(0,e.useRef)(),[y,w]=(0,e.useState)(null),[b,v]=(0,e.useState)(null),[P,x]=(0,e.useState)(null),[S,E]=(0,e.useState)(null),[j]=(0,e.useState)(h(d)),[F,T]=(0,e.useState)(!1),[M]=(0,e.useState)(new Map),C=(0,e.useRef)(null);var A=d.mapping3d.sdk.viewer.SDKViewer,O=d.mapping3d.sdk.viewer.Bounds,R=d.mapping3d.sdk.viewer.Coordinate,_=d.mapping3d.sdk.viewer.MapObject,k=(d.mapping3d.sdk.viewer.AList,d.mapping3d.sdk.viewer.AMap),L=d.mapping3d.sdk.viewer.Constants;(0,e.useEffect)((()=>{S&&null!=y&&null!=b&&S.setSize(y,b)}),[S,y,b]),(0,e.useEffect)((()=>{if(null!=m){var e=new k;e.set(L.STARTUP_APP_STATE,window.localStorage.getItem("orbit_mapping3d_state")),e.set(L.STARTUP_CRS,"4326"),e.set(L.STARTUP_THROTTLE_ANIMATION_SIGNALS,!0);const t=new A("Orbit 3D Mapping Experience Builder Widget",m.current,e);t.isReady.then((()=>E(t)))}}),[m]),(0,e.useEffect)((()=>{if(S){console.log("Viewer is ready!",S);const e=new Array,t=(e,t)=>(e.add(t),{remove:()=>e.remove(t)});return e.push(t(S.onAppStateChanged,I)),e.push(t(S.onWorkspaceOpened,Y)),e.push(t(S.onZoomToExtent,H)),e.push(t(S.onPanToPosition,K)),e.push(t(S.onPickPositionRequested,z)),e.push(t(S.onPickPositionCancelled,G)),e.push(t(S.onFootprintsChanged,W)),e.push(t(S.onGlobalsChanged,U)),e.push(t(S.onMeasureStateChanged,X)),e.push(t(S.onFieldOfViewsChanged,B)),()=>{e.forEach((e=>e.remove()))}}}),[S,P]),(0,e.useEffect)((()=>{if(P)return V(_.TYPE_FOOTPRINT),V(_.TYPE_MEASUREMENTS),V(_.TYPE_GLOBAL),V(_.TYPE_FOV),()=>{for(const e of M.values())P.map.layers.remove(e)}}),[P]),(0,e.useEffect)((()=>{if(P){let e=new Array;return e.push((0,c.watch)((()=>P.stationary),(e=>e&&J()))),e.push(P.on("click",q)),()=>{e.forEach((e=>e.remove()))}}})),(0,e.useEffect)((()=>{if(g){const e=new ResizeObserver((()=>{g.current&&(w(g.current.offsetWidth),v(g.current.offsetHeight))}));return e.observe(g.current),()=>{e.disconnect()}}}),[g]);const z=()=>{P.container.style.cursor="crosshair",T(!0)},G=()=>{P.container.style.cursor="auto",T(!1)},Y=()=>{console.log("Workspace is open.")},I=e=>{window.localStorage.setItem("orbit_mapping3d_state",e)},V=e=>{if(!M.has(e)){var t=new i.default;M.set(e,t),P.map.layers.add(t)}return M.get(e)},D=(e,t,r)=>{for(var o=0;o<r.size();o++){var i=r.get(o),l=j.getGraphicForMapObject(i),s=null;l&&i.label&&t&&(s=new n.default,l.geometry instanceof a.default?s.geometry=l.geometry:s.geometry=l.geometry.extent.center,s.symbol=j.getSymbolForLabel(i)),l&&e.add(l),s&&t.add(s)}},N=(0,e.useRef)({pending:!1,loading:!1}),W=()=>{if(null!=P)if(!0!==N.current.loading){N.current.pending=!1;var e=V(_.TYPE_FOOTPRINT),t=V(_.TYPE_FOOTPRINT+"-label"),r=P.extent,o=new s.default({wkid:4326});(0,u.canProject)(r,o)&&(r=(0,u.project)(r,o));var a=O.fromXY("4326",r.xmin,r.ymin,r.xmax,r.ymax);S.getFootprints2D(a,P.scale).finally((()=>{N.current.loading=!1,N.current.pending&&W()})).then((r=>{e.removeAll(),t.removeAll(),D(e,t,r)})).catch((e=>{console.error("Error calling getFootprints2D(",a,")",e)}))}else N.current.pending=!0},U=()=>{if(P){var e=V(_.TYPE_GLOBAL);e.removeAll();let t=S.getGlobals();D(e,null,t)}},X=()=>{if(P){var e=V(_.TYPE_MEASUREMENT);e.removeAll();let t=S.getMeasureState();D(e,null,t.mapObjects)}},B=()=>{if(P){var e=V(_.TYPE_FOV),t=V(_.TYPE_FOV+"-labels");e.removeAll(),t.removeAll();var r=S.getFieldOfViews2D();D(e,t,r)}},J=()=>{W();let e=(new Date).getTime();if(null!=C.current&&e-C.current<1e3)return;const t=P.toMap({x:P.width/2,y:P.height/2}),r=new s.default({wkid:4326});if((0,u.canProject)(t.spatialReference,r)){let e=(0,u.project)(t,r),o=R.fromXY("4326",e.x,e.y);S.setReferenceViewPosition(o)}},q=e=>{if(1==F){const t=P.toMap({x:e.x,y:e.y}),r=new s.default({wkid:4326});if((0,u.canProject)(t.spatialReference,r)){let e=(0,u.project)(t,r),o=R.fromXY("4326",e.x,e.y);S.setPickPosition(o)}P.container.style.cursor="auto",T(!1)}},H=e=>{let t=new l.default({xmin:e.minX,ymin:e.minY,xmax:e.maxX,ymax:e.maxY,spatialReference:new s.default({wkid:4326})});(0,u.canProject)(t,P)&&(t=(0,u.project)(t,P),C.current=(new Date).getTime(),P.extent=t)},K=e=>{let t=new a.default({x:e.x,y:e.y,spatialReference:new s.default({wkid:4326})});if((0,u.canProject)(t,P)){let e=(0,u.project)(t,P);C.current=(new Date).getTime(),P.center=e}};return t.React.createElement("div",{ref:g,className:"widget-demo jimu-widget m-0"},f.useMapWidgetIds&&1===f.useMapWidgetIds.length&&t.React.createElement(r.JimuMapViewComponent,{useMapWidgetId:null===(p=f.useMapWidgetIds)||void 0===p?void 0:p[0],onActiveViewChange:e=>{e&&e.view instanceof o.default?x(e.view):x(null)}}),t.React.createElement("div",{ref:m}))},S=r=>{const[o,a]=(0,e.useState)();return(0,e.useEffect)((()=>{(0,window.require)(["https://cdn.3dmapping.cloud/stable/javascript/viewer_sdk_javascript.js"],(e=>{a(e)}))}),[]),null==o?t.React.createElement("span",null,"Loading SDK..."):t.React.createElement(v,{widgetProps:r,orbitgt:o})};function E(e){P.p=e}})(),x})())}}}));